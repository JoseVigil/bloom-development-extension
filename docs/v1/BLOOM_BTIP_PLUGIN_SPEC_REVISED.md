# BLOOM_PLUGIN_SPEC_REVISED.md

## Propósito

Este documento define la **especificación técnica revisada** del **Bloom VSCode Plugin**, integrando todas las aclaraciones recientes sobre el alcance, las dependencias y la delegación de responsabilidades al CLI.

Todos los bloques de código dentro de este archivo usan **indentación de 4 espacios** en lugar de triple backticks, siguiendo la convención de Bloom para evitar conflictos de delimitadores en artifacts markdown.

---

## 1. Descripción general

El **Bloom VSCode Plugin** es un complemento que permite a los desarrolladores crear y gestionar **Bloom Technical Intent Packages (BTIPs)** y **codebases** directamente desde Visual Studio Code.

El plugin **no reemplaza al CLI**, sino que **lo invoca** para ejecutar todas las acciones lógicas.

El flujo es:

* El usuario ejecuta un comando desde VSCode.
* El plugin llama al **CLI `bloom`** con los parámetros correspondientes.
* El CLI crea o actualiza los archivos en el proyecto local.
* El plugin muestra el resultado (logs, notificaciones, archivos generados).

---

## 2. Alcance

* Solo soporta **Visual Studio Code**.
* No se dará soporte a **Visual Studio nativo**.
* Requiere tener instalado el **CLI `bloom`** previamente.
* No interactúa con APIs de IA ni realiza conexión a servicios externos.
* No gestiona autenticación, API keys ni telemetría.
* No descarga ni incluye plantillas dinámicas: el **Universal Template** es solo una referencia conceptual para el formateo.

---

## 3. Responsabilidades

### Plugin

* Proporcionar comandos dentro de VSCode para crear codebases e intents.
* Invocar el CLI `bloom` con los argumentos adecuados.
* Mostrar la salida y errores del CLI en el panel de salida de VSCode.
* Notificar resultados básicos (éxito o error) al usuario.

### CLI

* Gestionar toda la lógica de creación, actualización y sincronización de archivos BTIP.
* Manejar autenticación, conexión con IA, y operaciones de red.
* Generar los archivos `.codebase.bl`, `.intent.json`, `.report.bl`, etc.
* Responder al plugin con mensajes de texto o JSON parseables.

---

## 4. Comandos principales

El plugin expone las siguientes acciones:

1. **Bloom: Create Codebase**

   ```
    bloom create codebase <name> --files <paths>
   ```

2. **Bloom: Create Intent**

   ```
    bloom create intent <name> --files <paths>
   ```

3. **Bloom: Refresh Intent**

   ```
    bloom refresh intent <name>
   ```

Cada comando ejecuta el CLI en un proceso hijo, capturando stdout y stderr.

---

## 5. Interfaz de usuario

* **Command Palette**

  * Bloom: Create Codebase
  * Bloom: Create Intent
  * Bloom: Refresh Intent

* **Context Menu (File Explorer)**

  * Click derecho sobre archivos → Bloom → Create Codebase

* **Output Panel**

  * Canal de logs: “Bloom CLI Output”

* **Notificaciones**

  * Mensajes de éxito o error usando `vscode.window.showInformationMessage` o `showErrorMessage`.

---

## 6. Estructura técnica del plugin

```
src/
├── core/
│   ├── cliExecutor.ts        (ejecuta comandos del CLI)
│   ├── codebaseCreator.ts    (invoca CLI para crear codebases)
│   ├── intentCreator.ts      (invoca CLI para crear intents)
│   └── logger.ts             (gestiona logs y salida)
├── ui/
│   ├── notifications.ts      (mensajes al usuario)
│   └── panels.ts             (gestión futura de vistas o reportes)
└── extension.ts              (punto de entrada principal)
```

---

## 7. Ejemplo de ejecución (flujo completo)

1. El usuario selecciona varios archivos y ejecuta **Bloom: Create Codebase**.

2. El plugin solicita un nombre.

3. Se ejecuta el comando CLI:

   ```
    bloom create codebase ecommerce --files src/App.tsx src/utils/api.ts
   ```

4. El CLI genera `.bloom/ecommerce.codebase.bl` con formato estándar (indentación 4 espacios).

5. El plugin muestra notificación:

   ```
    ✅ Codebase 'ecommerce' created successfully.
   ```

6. La salida completa del CLI se muestra en el panel “Bloom CLI Output”.

---

## 8. Requisitos de formato

Los archivos `.codebase.bl` deben seguir el estilo Bloom:

```
# Bloom Codebase: <name>
> Generated by Bloom CLI

## Index
- src/App.tsx
- src/utils/api.ts

## File: src/App.tsx

    import React from 'react';
    export const App = () => <h1>Hello Bloom</h1>;
```

---

## 9. Configuración

El plugin no gestiona autenticación ni configuración de entorno.
El CLI utiliza su propio `.env` o `.bloomrc`:

```
.env
BLOOM_API_KEY=sk-xxxxx

.bloomrc
{
    "default_project": "my-bloom-demo"
}
```

Si el CLI no está instalado o no se encuentra en el PATH, el plugin debe mostrar:

```
❌ Bloom CLI no encontrado. Instálalo antes de usar el plugin.
```

---

## 10. Errores y validaciones

* Mostrar errores del CLI como notificaciones o en el panel de salida.
* Detectar si el usuario intenta crear una codebase sin archivos seleccionados.
* Detectar si el CLI devuelve código distinto de 0.
* No ejecutar nada si el workspace no está abierto.

---

## 11. Consideraciones adicionales

* El plugin **no implementará IA ni previsualizaciones** en la versión inicial.
* En el futuro podrá agregarse un panel de reportes para mostrar `.report.bl`.
* El formato de indentación de 4 espacios es **obligatorio** para mantener compatibilidad con los parsers Bloom.

---

## 12. Resultado esperado

El resultado debe ser un **plugin funcional para VSCode** que:

* Dependa exclusivamente del CLI Bloom.
* Permita crear codebases e intents desde el IDE.
* Genere archivos con formato Bloom correcto.
* No maneje autenticación ni telemetría.
* Use solo indentación de 4 espacios en los bloques de código.

---

Fin del documento.
