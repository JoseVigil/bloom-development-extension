Commands
│
├── Tree                           # Mapa visual del sistema
│   ├── generate                   # python -m core tree --out tree.txt
│   │                              # Output: Árbol de directorios estándar
│   │
│   └── generate-enriched          # python -m core tree --enriched --out enriched.txt
│                                  # Lee summary de headers [BLOOM-META] (2 líneas)
│                                  # Calcula: PageRank, Size Penalty
│                                  # Output: Árbol enriquecido para Context Planning
│
├── Create Nucleus                 # Gestión Organizacional (Macro)
│   ├── create                     # Inicializa estructura organizacional
│   ├── detect                     # Detecta proyectos hermanos
│   ├── validate                   # Valida integridad del nucleus
│   ├── list-projects              # Lista el inventario
│   ├── append-link                # Vincula proyecto existente
│   ├── append-clone               # Clona y vincula
│   └── unlink-project             # Desvincula
│
├── Create Project                 # Gestión Técnica (Micro)
│   └── Genesis                    # Ciclo de vida de Inicialización
│       │
│       ├── start                  # python -m core genesis start
│       │                          # Ejecuta: scaffold -> discovery -> planning -> execution -> index
│       │
│       ├── scaffold               # Crea .bloom/ + planta semillas en .project/
│       │
│       ├── discovery              # Genera .sys_info.md + .tree.bl
│       │
│       ├── planning               # Invoca 'context plan' con type=seed
│       │                          # Prioriza: .sys_info.md (CRÍTICO), .tree.bl (HIGH)
│       │
│       ├── execution              # Lee context_plan → build payload → Gemini hidrata semillas
│       │
│       └── index                  # Comprime docs generadas (.docbase.json)
│
├── Context                        # LÓGICA DE NEGOCIO CRÍTICA
│   │
│   ├── plan                       # python -m core context plan \
│   │                              #   --intent-dir .bloom/.intents/.dev/.uuid/ \
│   │                              #   --description "Fix bug" \
│   │                              #   --type dev
│   │                              # 
│   │                              # Flujo:
│   │                              # 1. Lee .codebase_index.json
│   │                              # 2. Genera enriched tree (o lee cache si existe)
│   │                              # 3. Construye prompt para Gemini
│   │                              # 4. Gemini prioriza archivos
│   │                              # 5. Valida response
│   │                              # 6. Guarda .context_plan.json
│   │                              #
│   │                              # Output: {
│   │                              #   "priority_tiers": {
│   │                              #     "critical": [max 10],
│   │                              #     "high": [max 20],
│   │                              #     "medium": [max 30]
│   │                              #   }
│   │                              # }
│   │
│   └── build-payload              # python -m core context build-payload \
│                                  #   --plan .context_plan.json \
│                                  #   --output .payload.json
│                                  # 
│                                  # 1. Lee .context_plan.json
│                                  # 2. Descomprime archivos usando FilesExtractor
│                                  # 3. Ordena por priority tiers
│                                  # 4. Genera .payload.json
│
├── Intents                        # [DINÁMICO] Ciclo de vida de Tareas (Dev & Doc)
│   │                              # Gestiona la creación, avance y estado de los intents.
│   │                              # 
│   │                              # ESTRUCTURA DE ESTADO (.intent_state.json):
│   │                              # {
│   │                              #   "id": "uuid",
│   │                              #   "type": "dev | doc",
│   │                              #   "phase": "briefing | execution | refinement",
│   │                              #   "turn": 0,
│   │                              #   "status": "active | completed | failed",
│   │                              #   "history": [...]
│   │                              # }
│   │
│   ├── create                     # python -m core intent create \
│   │                              #   --type dev \
│   │                              #   --name "fix-login-bug" \
│   │                              #   --desc "El login falla con caracteres especiales" \
│   │                              #   --files "src/auth/login.ts,src/utils/validation.ts"
│   │                              # 
│   │                              # RESPONSABILIDAD:
│   │                              # 1. Genera UUID y carpeta: .bloom/.intents/.dev/.uuid/
│   │                              # 2. Crea estructura inicial:
│   │                              #    - .dev_state.json (o .doc_state.json)
│   │                              #    - .briefing/.briefing.json (con el user request)
│   │                              #    - .briefing/.files/ (vacío, listo para compress)
│   │                              # 
│   │                              # OUTPUT:
│   │                              # { "intent_id": "uuid", "path": "..." }
│   │
│   ├── advance                    # python -m core intent advance \
│   │                              #   --intent-id "uuid" \
│   │                              #   --to-phase "execution"
│   │                              # 
│   │                              # RESPONSABILIDAD:
│   │                              # 1. Valida transición de estado (Briefing -> Execution)
│   │                              # 2. Prepara carpetas de la nueva fase
│   │                              # 3. Mueve/Copia artefactos necesarios (ej: context plan aprobado)
│   │                              # 4. Actualiza .intent_state.json
│   │
│   ├── refinement-turn            # python -m core intent refinement \
│   │                              #   --intent-id "uuid" \
│   │                              #   --turn-input "Mejora el manejo de errores"
│   │                              # 
│   │                              # RESPONSABILIDAD:
│   │                              # 1. Incrementa contador de turnos (N -> N+1)
│   │                              # 2. Crea carpeta: .refinement/.turn_{N+1}/
│   │                              # 3. Genera .turn.json con el input del usuario
│   │                              # 4. Prepara el entorno para un nuevo ciclo de Context/Payload
│   │
│   ├── context-init               # python -m core intent context-init \
│   │                              #   --intent-id "uuid" \
│   │                              #   --phase "briefing" 
│   │                              # 
│   │                              # [MACRO COMANDO DE PREPARACIÓN]
│   │                              # Ejecuta en secuencia:
│   │                              # 1. `compress` (genera .codebase.json/.docbase.json locales del intent)
│   │                              # 2. `tree --enriched` (mapa actualizado)
│   │                              # 3. `context plan` (Gemini Router decide qué usar)
│   │                              # 
│   │                              # RESULTADO:
│   │                              # .briefing/.context_plan.json LISTO para ser hidratado.
│   │
│   ├── hydrate                    # python -m core intent hydrate \
│   │                              #   --intent-id "uuid" \
│   │                              #   --phase "briefing"
│   │                              # 
│   │                              # RESPONSABILIDAD:
│   │                              # 1. Lee .context_plan.json de la fase actual
│   │                              # 2. Ejecuta `context build-payload`
│   │                              # 3. Genera .pipeline/{phase}/.payload.json
│   │                              # 4. Genera .pipeline/{phase}/.index.json
│   │
│   └── process-response           # python -m core intent process-response \
│                                  #   --intent-id "uuid" \
│                                  #   --phase "execution" \
│                                  #   --raw-file "response.txt"
│                                  # 
│                                  # RESPONSABILIDAD:
│                                  # 1. Lee el output crudo de la IA
│                                  # 2. Extrae bloques de código/texto
│                                  # 3. Guarda en .pipeline/{phase}/.response/.staging/
│                                  # 4. Genera reporte de cambios (.report.json)
│                                  # 5. Calcula checksums para validación
│
├── Compress / Extract             # Gestión de archivos comprimidos
│   ├── compress                   # python -m core compress --targets ./src --output .codebase.json
│   │                              # Usa: FilesCompressor (files_compressor.py)
│   │                              # - Escanea archivos según modo (codebase/docbase)
│   │                              # - Comprime con CodeCompressor (gzip+base64)
│   │                              # - Genera: .codebase.json + .codebase_index.json
│   │                              # - Filtros: extensiones, exclude patterns
│   │                              # - Stats: tamaños, ratios, languages
│   │
│   └── extract                    # python -m core extract --input .codebase.json --output ./restored/
│                                  # Usa: FilesExtractor (files_extractor.py)
│                                  # - Descomprime archivos
│                                  # - Valida hashes MD5
│                                  # - Restaura estructura de directorios
│
└── AI Submit                      # Envío automatizado a AI Web (Claude)
    │
    ├── submit                     # python -m core ai submit \
    │                              #   --payload .payload.json \
    │                              #   --provider claude \
    │                              #   --output submit_report.json
    │                              # 
    │                              # RESPONSABILIDAD PRINCIPAL:
    │                              # Envía un payload completo a una AI web usando Playwright
    │                              # sobre Chrome real y genera reporte de envío.
    │                              # 
    │                              # FLUJO INTERNO (sub-operaciones conceptuales):
    │                              # 
    │                              # 1. browser.launch
    │                              #    - Lanza o conecta a Chrome usando launch_persistent_context
    │                              #    - Usa perfil real del usuario
    │                              #    - Detecta bloqueo de perfil (PROFILE_LOCKED)
    │                              # 
    │                              # 2. browser.verify_auth
    │                              #    - Verifica si el usuario está logueado
    │                              #    - Chequea cookies / redirect
    │                              #    - Solicita login manual si es necesario
    │                              # 
    │                              # 3. provider.claude.inject_payload
    │                              #    - Inyecta el payload en el editor contenteditable
    │                              #    - Usa smart paste (paste + enter simulado)
    │                              #    - Maneja límites de caracteres (100K tokens)
    │                              # 
    │                              # 4. provider.claude.submit
    │                              #    - Ejecuta el envío (click / enter)
    │                              #    - Confirma que el mensaje salió
    │                              #    - Espera confirmación visual (spinner desaparece)
    │                              # 
    │                              # 5. submit.report
    │                              #    - Genera submit_report.json con:
    │                              #      * status: "success" | "failed" | "partial"
    │                              #      * provider: "claude"
    │                              #      * timestamps: inicio, fin, duración
    │                              #      * errors: [lista de errores si los hay]
    │                              #      * payload_hash: checksum del payload enviado
    │                              # 
    │                              # OUTPUT:
    │                              # submit_report.json
    │
    └── [Sub-operaciones]          # Operaciones internas (NO CLI, conceptuales)
        │
        ├── browser.launch         # Lanza Chrome con perfil persistente
        ├── browser.verify_auth    # Verifica autenticación del usuario
        ├── provider.claude.inject # Inyecta payload en editor
        ├── provider.claude.submit # Ejecuta envío y confirma
        └── submit.report          # Genera reporte de estado