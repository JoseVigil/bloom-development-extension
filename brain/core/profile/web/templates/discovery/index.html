<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Synapse Discovery</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <!-- DISCOVERY SCREEN -->
    <div id="screen-discovery" class="screen active">
      <!-- Status Circle -->
      <div class="status-circle" id="status-circle">
        <div class="circle-checkmark" id="circle-checkmark">‚úì</div>
      </div>
      
      <!-- Title -->
      <h1>Synapse Discovery</h1>
      
      <!-- Profile Name -->
      <p class="profile-name" id="profile-name-display">
        Profile: <span id="profile-alias-text">-</span>
      </p>
      
      <!-- Single Status Line -->
      <div class="status-line" id="status-line">
        <span id="status-text">Inicializando extensi√≥n</span>
      </div>
      
      <!-- Connection Info (single row) -->
      <div class="connection-row" id="connection-row" style="display: none;">
        <span id="profile-info">Profile: -</span>
        <span class="separator">‚Ä¢</span>
        <span id="connected-time">Conectado: -</span>
      </div>
      
      <!-- Countdown Label -->
      <div class="countdown-label" id="countdown-label">
        Esta ventana se cerrar√° en <span id="countdown-value">5</span> segundos
      </div>
      
      <!-- Error Container -->
      <div class="error-container" id="discovery-error">
        <div id="error-message">Error</div>
        <pre id="error-details"></pre>
      </div>
      
      <!-- Hidden progress counter -->
      <div class="debug-info" id="debug-info" style="display: none;">
        Intento: <span id="attempt-count">0</span>
      </div>
    </div>

    <!-- MULTI-PROVIDER SELECTOR SCREENS -->
    
    <!-- Provider Selection Screen (Step 2) -->
    <div id="screen-provider-select" class="screen">
      <div class="progress-bar"><div class="progress-fill" style="width: 40%"></div></div>
      <div class="step-indicator">Paso 2 de 4</div>
      <div class="status-icon">üîë</div>
      <h1>Selecciona tu AI Provider</h1>
      <p>¬øQu√© servicio de IA deseas configurar?</p>
      
      <div class="provider-grid">
        <button class="provider-card" data-provider="gemini">
          <div class="provider-icon">üî∑</div>
          <h3>Gemini</h3>
          <p>Google AI Studio</p>
          <span class="provider-badge">Gratis</span>
        </button>
        
        <button class="provider-card" data-provider="claude">
          <div class="provider-icon">üü†</div>
          <h3>Claude</h3>
          <p>Anthropic Console</p>
          <span class="provider-badge">Desde $5/mes</span>
        </button>
        
        <button class="provider-card" data-provider="openai">
          <div class="provider-icon">üü¢</div>
          <h3>ChatGPT</h3>
          <p>OpenAI Platform</p>
          <span class="provider-badge">Pay-as-you-go</span>
        </button>
        
        <button class="provider-card" data-provider="xai">
          <div class="provider-icon">‚ö°</div>
          <h3>Grok</h3>
          <p>xAI Console</p>
          <span class="provider-badge">Beta</span>
        </button>
      </div>
      
      <button class="btn-secondary" id="btn-skip-provider">Configurar despu√©s</button>
    </div>

    <!-- API Key Waiting Screen (Step 3) -->
    <div id="screen-api-waiting" class="screen">
      <div class="progress-bar"><div class="progress-fill" style="width: 66%"></div></div>
      <div class="step-indicator">Paso 3 de 4</div>
      <div class="spinner"></div>
      <h1>Esperando API Key...</h1>
      <p>Crea y copia tu API Key de <strong id="provider-name-display">Gemini</strong>.<br>La detectaremos autom√°ticamente cuando la copies.</p>
      
      <div class="info-box">
        <h3 id="instructions-title">Instrucciones:</h3>
        <ol id="instructions-list">
          <li>Haz clic en "Crear API Key"</li>
          <li>Copia la clave generada</li>
          <li>Vuelve a esta ventana</li>
        </ol>
      </div>
      
      <div class="key-format-hint" id="key-format-hint">
        <strong>Formato esperado:</strong> <code id="key-format-example">AIzaSy...</code>
      </div>
      
      <button class="btn" id="btn-open-console">Ir a Console</button>
      <button class="btn-secondary" id="btn-back-to-providers">Elegir otro provider</button>
    </div>

    <!-- API Key Success Screen (Step 4) -->
    <div id="screen-api-success" class="screen">
      <div class="progress-bar"><div class="progress-fill" style="width: 100%"></div></div>
      <div class="success-checkmark">‚úì</div>
      <h1>¬°API Key Registrada!</h1>
      <p>Tu clave de <strong id="success-provider-name">Gemini</strong> ha sido guardada de forma segura.</p>
      
      <div class="info-box">
        <p><strong>Provider:</strong> <span id="success-provider-display">Gemini</span></p>
        <p><strong>Profile:</strong> <span id="success-profile-name">Personal</span></p>
        <p><strong>Estado:</strong> ‚úì Validada y activa</p>
      </div>
      
      <div class="action-buttons">
        <button class="btn" id="btn-add-another-key">Agregar otra clave</button>
        <button class="btn-secondary" id="btn-finish-setup">Finalizar configuraci√≥n</button>
      </div>
    </div>

    <!-- ONBOARDING SCREENS -->
    <div id="screen-onboarding-welcome" class="screen">
      <div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div>
      <div class="step-indicator">Paso 1 de 3</div>
      <div class="status-icon">üå∏</div>
      <h1>Bienvenido a Bloom</h1>
      <p>Vamos a configurar tu perfil en 2 pasos simples.<br>Necesitar√°s una cuenta de Google y crear una API Key de Gemini.</p>
      <button class="btn" id="btn-start-onboarding">Comenzar</button>
    </div>

    <div id="screen-google-login" class="screen">
      <div class="progress-bar"><div class="progress-fill" style="width: 33%"></div></div>
      <div class="step-indicator">Paso 2 de 3</div>
      <div class="status-icon">üîê</div>
      <h1>Inicia sesi√≥n con Google</h1>
      <p>Necesitamos que inicies sesi√≥n en tu cuenta de Google para continuar.</p>
      <button class="btn" id="btn-google-login">Iniciar sesi√≥n con Google</button>
    </div>

    <div id="screen-google-waiting" class="screen">
      <div class="progress-bar"><div class="progress-fill" style="width: 33%"></div></div>
      <div class="step-indicator">Paso 2 de 3</div>
      <div class="spinner"></div>
      <h1>Esperando inicio de sesi√≥n...</h1>
      <p>Completa el inicio de sesi√≥n en la pesta√±a que se abri√≥.<br>Detectaremos autom√°ticamente cuando hayas iniciado sesi√≥n.</p>
    </div>

    <div id="screen-gemini-api" class="screen">
      <div class="progress-bar"><div class="progress-fill" style="width: 66%"></div></div>
      <div class="step-indicator">Paso 3 de 3</div>
      <div class="status-icon">üîë</div>
      <h1>Crea tu Gemini API Key</h1>
      <div class="info-box">
        <h3>Instrucciones:</h3>
        <ol>
          <li>Haz clic en "Crear API Key" en la nueva pesta√±a</li>
          <li>Copia la clave generada</li>
          <li>La detectaremos autom√°ticamente</li>
        </ol>
      </div>
      <button class="btn" id="btn-open-aistudio">Ir a AI Studio</button>
    </div>

    <div id="screen-gemini-waiting" class="screen">
      <div class="progress-bar"><div class="progress-fill" style="width: 66%"></div></div>
      <div class="step-indicator">Paso 3 de 3</div>
      <div class="spinner"></div>
      <h1>Esperando API Key...</h1>
      <p>Crea y copia tu API Key en AI Studio.<br>La detectaremos autom√°ticamente cuando la copies.</p>
    </div>

    <div id="screen-onboarding-success" class="screen">
      <div class="progress-bar"><div class="progress-fill" style="width: 100%"></div></div>
      <div class="success-checkmark">‚úì</div>
      <h1>¬°Configuraci√≥n completa!</h1>
      <p>Tu perfil est√° listo para usar.<br>Esta ventana se cerrar√° autom√°ticamente.</p>
      <div class="info-box">
        <p><strong>Email:</strong> <span id="final-email">-</span></p>
        <p><strong>API Key:</strong> ‚úì Configurada</p>
      </div>
    </div>
  </div>

  <script src="../discovery.synapse.config.js"></script>
  <script src="discoveryProtocol.js"></script>
  <script src="discovery.js"></script>
</body>
</html>