<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self' http://localhost:* ws://localhost:*;">
  <title>Bloom Nucleus Installer</title>
  <link rel="stylesheet" href="./styles.css">
  <style>
    /* Animaci√≥n ripple para heartbeat */
    @keyframes ripple-effect {
      0% {
        width: 60px;
        height: 60px;
        opacity: 0.8;
      }
      100% {
        width: 140px;
        height: 140px;
        opacity: 0;
      }
    }

    /* Cambiar color de ripples cuando el dot se vuelve verde */
    .status-dot.green + .ripple,
    .status-dot.green ~ .ripple {
      border-color: #48bb78 !important;
    }
  </style>
</head>
<body>
  <div class="container">
    
    <!-- 1. WELCOME SCREEN -->
    <div class="screen active" id="welcome-screen">
      <div class="card">
        <div class="logo">B</div>
        <h1>Bloom Nucleus</h1>
        <p class="text-center">
          Instalaci√≥n autom√°tica de tu asistente IA local.<br>
          <strong>Zero Config. Zero Admin. Modo Dios.</strong>
        </p>
        
        <div class="info-box">
          <strong>üìç Ubicaci√≥n:</strong>
          <code id="install-path">%LOCALAPPDATA%\BloomNucleus</code>
        </div>

        <div class="info-box" style="background: #f0fff4; border-left-color: #48bb78;">
          ‚úÖ Instalaci√≥n local (Sin permisos de administrador)<br>
          ‚úÖ Motor IA + Chrome Profile aislado<br>
          ‚úÖ Extensi√≥n configurada autom√°ticamente
        </div>

        <div class="button-group">
          <button class="button" id="start-button">üöÄ INSTALAR BLOOM NUCLEUS</button>
        </div>
      </div>
    </div>

    <!-- 2. INSTALLATION SCREEN -->
    <div class="screen" id="installation-screen">
      <div class="card">
        <div class="logo">B</div>
        <h1>Desplegando Sistema</h1>
        <p class="text-center">Configurando motor IA, perfiles y extensi√≥n...</p>
        
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <div class="progress-text" id="progress-text">Iniciando despliegue...</div>
        </div>
        
        <div class="spinner"></div>
        
        <div id="installation-details" style="margin-top: 30px; font-size: 14px; color: #4299e1; text-align: center; min-height: 24px;">
          <!-- Din√°mico -->
        </div>
      </div>
    </div>

    <!-- 3. SUCCESS SCREEN -->
    <div class="screen" id="success-screen">
      <div class="card">
        <div class="success-icon">‚úì</div>
        <h1>Sistema Instalado</h1>
        <p class="text-center">Bloom Nucleus est√° instalado y configurado.<br>Falta verificar la conexi√≥n entre componentes.</p>

        <div class="success-box">
          <strong>üìä Componentes Desplegados:</strong>
          <ul style="margin-left: 20px; margin-top: 10px; text-align: left;">
            <li>Motor IA: <strong>Activo</strong></li>
            <li>Extension ID: <code id="final-extension-id">...</code></li>
            <li>Perfil Maestro: <code id="final-profile-id">...</code></li>
            <li>Native Host: <strong>Registrado en HKCU</strong></li>
          </ul>
        </div>

        <div class="button-group">
          <button class="button button-secondary" id="final-view-logs-btn">üìÑ Ver Logs</button>
          <button class="button" id="launch-bloom-btn">üîå CONECTAR</button>
        </div>
      </div>
    </div>

    <!-- 4. HEARTBEAT VALIDATION SCREEN -->
    <div class="screen" id="heartbeat-screen">
      <div class="card">
        <div class="logo">B</div>
        <h1>Validando Conexi√≥n</h1>
        <p class="text-center">Conectando extensi√≥n con el motor IA...</p>

        <div class="info-box" style="background: #ebf8ff; border-left-color: #4299e1; text-align: center; padding: 40px 20px;">
          
          <!-- Heartbeat visual con ondas -->
          <div style="position: relative; width: 100px; height: 100px; margin: 0 auto;">
            <div class="status-dot red" id="heartbeat-dot" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; z-index: 2;"></div>
            <div class="ripple" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; border-radius: 50%; border: 3px solid #f56565; opacity: 0; animation: ripple-effect 2s ease-out infinite;"></div>
            <div class="ripple" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; border-radius: 50%; border: 3px solid #f56565; opacity: 0; animation: ripple-effect 2s ease-out infinite; animation-delay: 0.5s;"></div>
            <div class="ripple" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; border-radius: 50%; border: 3px solid #f56565; opacity: 0; animation: ripple-effect 2s ease-out infinite; animation-delay: 1s;"></div>
            <div class="ripple" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; border-radius: 50%; border: 3px solid #f56565; opacity: 0; animation: ripple-effect 2s ease-out infinite; animation-delay: 1.5s;"></div>
          </div>

          <!-- Status message din√°mico -->
          <p id="heartbeat-counter" style="font-size: 16px; color: #4a5568; font-weight: 500; margin-top: 30px; text-align: center; min-height: 24px;">
            üîç Iniciando conexi√≥n...
          </p>
          
          <button class="button button-secondary" id="retry-heartbeat-btn" style="display: none; margin-top: 30px;">
            üîÑ Reintentar Conexi√≥n
          </button>
        </div>

        <!-- Success box - Solo aparece al final -->
        <div class="success-box" id="connection-details" style="margin-top: 20px; display: none; background: #e6fffa; border-left-color: #4299e1;">
          <strong style="color: #0987a0; font-size: 18px;">‚úì Conexi√≥n Exitosa</strong>
          <p style="margin-top: 12px; font-size: 14px;">Extension ID: <code id="heartbeat-extension-id">...</code></p>
          <p style="font-size: 14px;">Profile ID: <code id="heartbeat-profile-id">...</code></p>
        </div>
      </div>
    </div>

    <!-- 5. CONNECTION SUCCESS SCREEN -->
    <div class="screen" id="connection-success-screen">
      <div class="card">
        <div class="logo">B</div>
        <h1>Conexi√≥n Verificada</h1>
        <p class="text-center">Todos los componentes est√°n comunic√°ndose correctamente.</p>

        <div class="info-box" style="background: #ebf8ff; border-left-color: #4299e1; text-align: center; padding: 30px 20px;">
          <div style="font-size: 96px; margin-bottom: 20px; color: #48bb78;">‚úì</div>
          <p style="margin-top: 8px; font-size: 15px; color: #2c5282;">Paso 1/3: Chrome iniciado ‚úÖ</p>
          <p style="font-size: 15px; color: #2c5282;">Paso 2/3: Extensi√≥n cargada ‚úÖ</p>
          <p style="font-size: 15px; color: #2c5282;">Paso 3/3: Host conectado ‚úÖ</p>
        </div>

        <div class="button-group">
          <button class="button" id="start-onboarding-btn" style="font-size: 18px; padding: 15px 30px;">
            üöÄ INICIAR ONBOARDING
          </button>
        </div>
      </div>
    </div>

    <!-- 6. ERROR SCREEN -->
    <div class="screen" id="error-screen">
      <div class="card">
        <div class="error-icon">‚úï</div>
        <h1>Error en la Instalaci√≥n</h1>
        <p class="text-center" id="error-message">Ha ocurrido un error.</p>
        
        <div class="warning-box" style="text-align: left; margin-top: 20px;">
          <strong>üîç Informaci√≥n de Debug:</strong>
          <pre id="error-stack" style="font-size: 11px; overflow-x: auto; margin-top: 10px;"></pre>
        </div>
        
        <div class="button-group">
          <button class="button button-secondary" id="view-error-logs-btn">Ver Logs Completos</button>
          <button class="button" id="retry-button">üîÑ Reintentar</button>
        </div>
      </div>
    </div>

  </div>

  <script src="renderer.js"></script>
</body>
</html>