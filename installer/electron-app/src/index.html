<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self' http://localhost:* ws://localhost:*;">
  <title>Bloom Nucleus Installer</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="container">
    
    <!-- 1. WELCOME SCREEN -->
    <div class="screen active" id="welcome-screen">
      <div class="card">
        <div class="logo">B</div>
        <h1>Bloom Nucleus</h1>
        <p class="text-center">
          InstalaciÃ³n automÃ¡tica de tu asistente IA local.<br>
          <strong>Zero Config. Zero Admin. Modo Dios.</strong>
        </p>
        
        <div class="info-box">
          <strong>ğŸ“ UbicaciÃ³n:</strong>
          <code id="install-path">%LOCALAPPDATA%\BloomNucleus</code>
        </div>

        <div class="info-box" style="background: #f0fff4; border-left-color: #48bb78;">
          âœ… InstalaciÃ³n local (Sin permisos de administrador)<br>
          âœ… Motor IA + Chrome Profile aislado<br>
          âœ… ExtensiÃ³n configurada automÃ¡ticamente
        </div>

        <div class="button-group">
          <button class="button" id="start-button">ğŸš€ INSTALAR BLOOM NUCLEUS</button>
        </div>
      </div>
    </div>

    <!-- 2. INSTALLATION SCREEN -->
    <div class="screen" id="installation-screen">
      <div class="card">
        <div class="logo">B</div>
        <h1>Desplegando Sistema</h1>
        <p class="text-center">Configurando motor IA, perfiles y extensiÃ³n...</p>
        
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <div class="progress-text" id="progress-text">Iniciando despliegue...</div>
        </div>
        
        <div class="spinner"></div>
        
        <div id="installation-details" style="margin-top: 30px; font-size: 13px; color: #718096; text-align: center;">
          <p id="detail-line-1">â€¢ Copiando runtime Python...</p>
          <p id="detail-line-2">â€¢ Instalando motor Brain...</p>
          <p id="detail-line-3">â€¢ Registrando Native Host...</p>
          <p id="detail-line-4">â€¢ Calculando Extension ID...</p>
          <p id="detail-line-5">â€¢ Creando perfil maestro...</p>
        </div>
      </div>
    </div>

    <!-- 3. SUCCESS SCREEN CON HEARTBEAT -->
    <div class="screen" id="success-screen">
      <div class="card">
        <div class="success-icon">âœ“</div>
        <h1>Â¡Sistema Listo!</h1>
        <p class="text-center">Bloom Nucleus estÃ¡ instalado y configurado.</p>

        <div class="success-box">
          <strong>ğŸ“Š Componentes Desplegados:</strong>
          <ul style="margin-left: 20px; margin-top: 10px; text-align: left;">
            <li>Motor IA: <strong>Activo</strong> (<code id="final-brain-dir">...</code>)</li>
            <li>Extension ID: <code id="final-extension-id">...</code></li>
            <li>Perfil Maestro: <code id="final-profile-id">...</code></li>
            <li>Native Host: <strong>Registrado en HKCU</strong></li>
          </ul>
        </div>

        <!-- HEARTBEAT VISUAL (Post-Launch) -->
        <div id="heartbeat-container" style="display: none; margin: 30px 0;">
          <div class="info-box" style="background: #ebf8ff; border-left-color: #4299e1; text-align: center;">
            <strong>ğŸ”— Validando ConexiÃ³n</strong>
            <div style="margin: 20px 0;">
              <div class="status-dot red" id="heartbeat-dot"></div>
            </div>
            <p id="heartbeat-status" style="font-size: 14px; color: #4a5568; margin-top: 10px;">
              Esperando seÃ±al de Chrome...
            </p>
          </div>
        </div>

        <!-- SUCCESS BADGE (Post-Heartbeat) -->
        <div id="connection-success" style="display: none; margin: 30px 0;">
          <div class="success-box" style="text-align: center;">
            <div style="font-size: 48px; margin-bottom: 15px;">âœ“</div>
            <strong style="font-size: 18px; color: #48bb78;">Â¡ConexiÃ³n Verificada!</strong>
            <p style="margin-top: 10px; font-size: 14px; color: #2d5016;">
              El sistema estÃ¡ operacional. Puedes cerrar este instalador.
            </p>
          </div>
        </div>

        <div class="button-group">
          <button class="button button-secondary" id="final-view-logs-btn">ğŸ“„ Ver Logs</button>
          <button class="button" id="launch-bloom-btn">ğŸš€ LANZAR BLOOM</button>
        </div>
      </div>
    </div>

    <!-- 4. ERROR SCREEN -->
    <div class="screen" id="error-screen">
      <div class="card">
        <div class="error-icon">âœ•</div>
        <h1>Error en la InstalaciÃ³n</h1>
        <p class="text-center" id="error-message">Ha ocurrido un error.</p>
        
        <div class="warning-box" style="text-align: left; margin-top: 20px;">
          <strong>ğŸ” InformaciÃ³n de Debug:</strong>
          <pre id="error-stack" style="font-size: 11px; overflow-x: auto; margin-top: 10px;"></pre>
        </div>
        
        <div class="button-group">
          <button class="button button-secondary" id="view-error-logs-btn">Ver Logs Completos</button>
          <button class="button" id="retry-button">ğŸ”„ Reintentar</button>
        </div>
      </div>
    </div>

  </div>

  <script src="renderer.js"></script>
</body>
</html>