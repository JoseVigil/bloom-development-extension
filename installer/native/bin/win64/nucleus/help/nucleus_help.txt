
                                                        NUCLEUS
                                                 Governance Magistrate


------------------------------------------------------------------------------------------------------------------------
  USAGE
------------------------------------------------------------------------------------------------------------------------

  nucleus [OPTIONS] <command> [args]

  Quick examples:
    nucleus version                    # Display version information
    nucleus info                       # Show system information
    nucleus --json info              # JSON output for automation


------------------------------------------------------------------------------------------------------------------------
  GLOBAL OPTIONS
------------------------------------------------------------------------------------------------------------------------

  --json           Output in JSON format (machine-readable)

           âš ï¸  CRITICAL: Flag MUST be placed BEFORE the command
           âœ… CORRECT:   nucleus --json synapse seed profile
           âŒ WRONG:     nucleus synapse seed profile --json

           When using --json, logs go to stderr and JSON to stdout.
           For clean JSON output in scripts, redirect stderr:
             PowerShell:  nucleus --json info 2>$null
             Bash:        nucleus --json info 2>/dev/null

  --verbose        Enable detailed logging for debugging
  --help           Show this help message


------------------------------------------------------------------------------------------------------------------------
  COMMAND CATEGORIES
------------------------------------------------------------------------------------------------------------------------

  SYSTEM             System information and diagnostics                       2 cmds
  DIAGNOSTICS        Health checks, log inspection and system diagnostics     2 cmds
  GOVERNANCE         Organization initialization and authority                4 cmds
  TEAM               Team and collaboration management                        3 cmds
  VAULT              Secure key and credential management                     4 cmds
  SYNC               State synchronization with central server                2 cmds
  ANALYTICS          System monitoring and telemetry                          1 cmd
  TELEMETRY          Centralized log stream registration                      1 cmd
  TEMPORAL_SERVER    Temporal server management and diagnostics               1 cmd
  ORCHESTRATION      Workflow orchestration and automation                    4 cmds
  ---------------------------------------------------------------------------  Total: 24 commands


=======================================================[ SYSTEM ]=======================================================

  > INFO
    Display detailed system information

    Usage: nucleus info

    --------------------------------------------------------------------------------

  > VERSION
    Display version and build information

    Usage: nucleus version

    --------------------------------------------------------------------------------


====================================================[ DIAGNOSTICS ]=====================================================

  > HEALTH
    System integrity check â€” all components in parallel (<3s)

    Usage: nucleus health

    Flags:
      --component                Check only one component (temporal, worker, brain_service, etc.)
      --fix                      Attempt automated remediation of known failures
      --json                     Output result as JSON
      --validate                 Deep validation checks (slower)

    Example:
        nucleus health
        nucleus health --fix
        nucleus health --component brain_service
        nucleus --json health
        nucleus --json health --fix
        nucleus health --validate

    JSON Response:
      {
        "success": false,
        "state": "DEGRADED",
        "error": "2 non-critical components unhealthy",
        "timestamp": 1740000000,
        "components": {
          "temporal":       { "healthy": true,  "state": "RUNNING",      "port": 7233,  "latency_ms": 4  },
          "worker":         { "healthy": false, "state": "DISCONNECTED",  "error": "Worker process not found in supervisor" },
          "ollama":         { "healthy": true,  "state": "RUNNING",       "port": 11434, "latency_ms": 3  },
          "control_plane":  { "healthy": true,  "state": "RUNNING",       "pid": 9821   },
          "vault":          { "healthy": true,  "state": "UNLOCKED"       },
          "governance":     { "healthy": true,  "state": "VALID"          },
          "brain_service":  { "healthy": false, "state": "UNREACHABLE",   "port": 5678,  "error": "Port 5678 not accessible" },
          "bloom_api":      { "healthy": true,  "state": "RUNNING",       "port": 48215, "latency_ms": 12 },
          "svelte_dev":     { "healthy": true,  "state": "RUNNING",       "port": 5173,  "latency_ms": 5  },
          "worker_manager": { "healthy": true,  "state": "ACTIVE",        "profiles_count": 1 }
        },
        "brain_last_errors": {
          "brain_service_log":   ["2026-02-20 22:50:09 ERROR Connection reset by peer"],
          "brain_event_bus_log": ["2026-02-20 22:50:09 ERROR WinError 64: pipe broken"]
        }
      }

    --------------------------------------------------------------------------------

  > LOGS
    Read and filter component logs via telemetry.json index

    Usage: nucleus logs [component]

    Arguments:
      component             optional

    Flags:
      --errors-only              Show only WARNING and ERROR lines
      --json                     Output result as JSON
      --launch                   Correlate all logs for a launch ID (e.g. 001_7a30f1a6_195107)
      --no-startup               Exclude initialization/startup noise lines
      --since                    Show lines from the last X duration (e.g. 5m, 2h, 30s)

    Example:
        nucleus logs brain_server
        nucleus logs brain_server --since 10m --errors-only --no-startup
        nucleus logs sentinel_core --since 1h
        nucleus logs brain_service --errors-only
        nucleus logs --launch 001_7a30f1a6_195107
        nucleus --json logs brain_server --since 5m --errors-only

    JSON Response:
      {
        "success": true,
        "component": "brain_server",
        "lines": [
          "2026-02-20 22:50:09 ERROR WinError 64: The specified network name is no longer available",
          "2026-02-20 22:50:09 ERROR Connection reset by peer"
        ],
        "count": 2
      }

    --------------------------------------------------------------------------------


=====================================================[ GOVERNANCE ]=====================================================

  > ALFRED
    Muestra el reporte de salud administrativa y estado de la BÃ³veda

    Usage: nucleus alfred status

    Arguments:
      status                required

    Flags:
      --json                     Salida en formato JSON (para Conductor u otras herramientas)

    --------------------------------------------------------------------------------

  > ALFRED
    Inicia el custodio administrativo y los servidores de autoridad

    Usage: nucleus alfred start

    Arguments:
      start                 required

    --------------------------------------------------------------------------------

  > ALFRED
    Ejecuta una verificaciÃ³n de integridad manual sobre el sistema de archivos

    Usage: nucleus alfred audit

    Arguments:
      audit                 required

    --------------------------------------------------------------------------------

  > INIT
    Initialize Nucleus organization

    Usage: nucleus init

    Flags:
      --github-id                GitHub username
      --master                   Initialize as master
      --name                     Display name

    --------------------------------------------------------------------------------


========================================================[ TEAM ]========================================================

  > ADD
    Add team member

    Usage: nucleus add <github-id>

    Arguments:
      <github-id>           required

    Flags:
      --name                     Display name
      --role                     Role [default: specialist]

    --------------------------------------------------------------------------------

  > LIST
    List team members

    Usage: nucleus list

    --------------------------------------------------------------------------------

  > REMOVE
    Remove team member

    Usage: nucleus remove <github-id>

    Arguments:
      <github-id>           required

    --------------------------------------------------------------------------------


=======================================================[ VAULT ]========================================================

  > VAULT-LOCK
    Lock vault

    Usage: nucleus vault-lock

    --------------------------------------------------------------------------------

  > VAULT-REQUEST
    Request key from vault

    Usage: nucleus vault-request <key-id>

    Arguments:
      <key-id>              required

    --------------------------------------------------------------------------------

  > VAULT-STATUS
    Display vault status

    Usage: nucleus vault-status

    --------------------------------------------------------------------------------

  > VAULT-UNLOCK
    Unlock vault

    Usage: nucleus vault-unlock

    --------------------------------------------------------------------------------


========================================================[ SYNC ]========================================================

  > SYNC-PULL
    Pull permissions from central server

    Usage: nucleus sync-pull

    --------------------------------------------------------------------------------

  > SYNC-PUSH
    Push state to central server

    Usage: nucleus sync-push

    --------------------------------------------------------------------------------


=====================================================[ ANALYTICS ]======================================================

  > HEARTBEAT
    Send heartbeat to central server

    Usage: nucleus heartbeat

    Flags:
      --volume                   Intent volume [default: 0]
      --workers                  Active workers count [default: 0]

    --------------------------------------------------------------------------------


=====================================================[ TELEMETRY ]======================================================

  > TELEMETRY
    Centralized log stream registration

    Usage: nucleus telemetry

    Subcommands:
      register              Register or update a telemetry stream
        nucleus telemetry register

    Subcommand Details:

      â””â”€ REGISTER
        Register or update a telemetry stream

        Usage: nucleus telemetry register

        Flags:
          --label                    Display label with emoji (required)
          --path                     Absolute path to log file (required)
          --priority                 Priority level: 1=critical, 2=important, 3=informational [default: 2]
          --stream                   Stream identifier (required)

        Example:
            nucleus telemetry register --stream test --label "ðŸ§ª TEST" --path "C:/logs/test.log" --priority 3
            nucleus --json telemetry register --stream worker --label "ðŸ§  WORKER" --path "C:/logs/worker.log"

        JSON Response:
          {
            "success": true,
            "stream_id": "electron_install",
            "message": "Stream registered successfully"
          }

        ----------------------------------------------------------------------

    --------------------------------------------------------------------------------


==================================================[ TEMPORAL_SERVER ]===================================================

  > TEMPORAL
    Manage Temporal Server lifecycle

    Usage: nucleus temporal

    Subcommands:
      cleanup               Clean up zombie Temporal processes on port 7233
        nucleus temporal cleanup
      diagnostics           Run comprehensive Temporal diagnostics
        nucleus temporal diagnostics
      ensure                Ensure Temporal Server is running (non-interactive, automation-safe)
        nucleus temporal ensure
      force-stop            Forcefully stop all Temporal processes
        nucleus temporal force-stop
      start                 Start Temporal Server (interactive mode)
        nucleus temporal start
      status                Check Temporal Server status
        nucleus temporal status
      stop                  Stop running Temporal Server
        nucleus temporal stop

    Subcommand Details:

      â””â”€ CLEANUP
        Clean up zombie Temporal processes on port 7233

        Usage: nucleus temporal cleanup

        Example:
              nucleus temporal cleanup
              nucleus --json temporal cleanup

        JSON Response:
          {
            "command": "temporal_cleanup",
            "port": 7233,
            "found_process": true,
            "pid": 19580,
            "executable": "C:\\Users\\user\\AppData\\Local\\BloomNucleus\\bin\\temporal\\temporal.exe",
            "action_taken": "killed",
            "port_free_after": true,
            "errors": []
          }

        ----------------------------------------------------------------------

      â””â”€ DIAGNOSTICS
        Run comprehensive Temporal diagnostics

        Usage: nucleus temporal diagnostics

        Example:
            nucleus temporal diagnostics
            nucleus --json temporal diagnostics

        JSON Response:
          {
            "executable": {
              "path": "C:\\Users\\user\\AppData\\Local\\BloomNucleus\\bin\\temporal\\temporal.exe",
              "exists": true,
              "size": 123456789
            },
            "health": {
              "operational": true,
              "state": "RUNNING",
              "grpc_responding": true,
              "ui_responding": true
            },
            "database": {
              "path": "C:\\Users\\user\\AppData\\Local\\BloomNucleus\\logs\\temporal\\temporal.db",
              "exists": true,
              "size": 98304
            },
            "pid_file": {
              "path": "C:\\Users\\user\\AppData\\Local\\BloomNucleus\\logs\\temporal\\temporal.pid",
              "exists": true,
              "pid": 12345
            },
            "overall_status": "HEALTHY"
          }

        ----------------------------------------------------------------------

      â””â”€ ENSURE
        Ensure Temporal Server is running (non-interactive, automation-safe)

        Usage: nucleus temporal ensure

        Example:
            nucleus temporal ensure

        JSON Response:
          {
            "success": true,
            "state": "RUNNING",
            "started": true,
            "pid": 14192,
            "grpc_port": 7233,
            "ui_port": 8233,
            "ui_url": "http://localhost:8233",
            "grpc_url": "localhost:7233"
          }

        ----------------------------------------------------------------------

      â””â”€ FORCE-STOP
        Forcefully stop all Temporal processes

        Usage: nucleus temporal force-stop

        Example:
              nucleus temporal force-stop
              nucleus --json temporal force-stop

        JSON Response:
          {
            "command": "temporal_force_stop",
            "processes_found": 2,
            "processes_killed": 2,
            "port_7233_free": true,
            "state_cleaned": true,
            "details": [
              {
                "pid": 19580,
                "executable": "C:\\Users\\user\\AppData\\Local\\BloomNucleus\\bin\\temporal\\temporal.exe",
                "killed": true
              }
            ],
            "errors": []
          }

        ----------------------------------------------------------------------

      â””â”€ START
        Start Temporal Server (interactive mode)

        Usage: nucleus temporal start

        Example:
            nucleus temporal start
            nucleus --json temporal start

        JSON Response:
          {
            "temporal": {
              "state": "RUNNING",
              "pid": 12345,
              "grpc_port": 7233,
              "ui_port": 8233,
              "ui_url": "http://localhost:8233",
              "grpc_url": "localhost:7233"
            }
          }

        ----------------------------------------------------------------------

      â””â”€ STATUS
        Check Temporal Server status

        Usage: nucleus temporal status

        Example:
            nucleus temporal status
            nucleus --json temporal status

        JSON Response:
          {
            "temporal": {
              "operational": true,
              "state": "RUNNING",
              "ui_port": 8233,
              "grpc_port": 7233,
              "ui_url": "http://localhost:8233",
              "grpc_url": "localhost:7233",
              "health_checks": {
                "grpc": true,
                "ui": true
              }
            }
          }

        ----------------------------------------------------------------------

      â””â”€ STOP
        Stop running Temporal Server

        Usage: nucleus temporal stop

        Example:
            nucleus temporal stop
            nucleus --json temporal stop

        JSON Response:
          {
            "temporal": {
              "state": "STOPPED",
              "message": "Temporal Server stopped successfully"
            }
          }

        ----------------------------------------------------------------------

    --------------------------------------------------------------------------------


===================================================[ ORCHESTRATION ]====================================================

  > DEV-START
    Start Nucleus development environment with full boot sequence

    Usage: nucleus dev-start

    Flags:
      --json                     Output result as JSON
      --simulation               Run in simulation mode (use test ownership.json)
      --skip-vault               Skip vault verification (development only)

    Example:
        nucleus dev-start
        nucleus dev-start --simulation
        nucleus dev-start --skip-vault

    --------------------------------------------------------------------------------

  > SERVICE
    Service lifecycle management for Windows (NSSM)

    Usage: nucleus service

    Subcommands:
      start                 Start Nucleus as Windows service (daemon mode)
        nucleus service start
      status                Check Nucleus service status
        nucleus service status
      stop                  Stop running Nucleus service gracefully
        nucleus service stop

    Subcommand Details:

      â””â”€ START
        Start Nucleus as Windows service (daemon mode)

        Usage: nucleus service start

        Flags:
          --json                     Output result as JSON
          --skip-vault               Skip vault verification (development only)

        Example:
            nucleus service start
            nucleus service start --skip-vault
            nucleus --json service start

        JSON Response:
          {
            "success": true,
            "pid": 12345,
            "boot_time_seconds": 8.5,
            "components": {
              "temporal": "running",
              "worker": "running",
              "ollama": "running",
              "control_plane": "running",
              "vault": "unlocked"
            },
            "ollama_pid": 12346,
            "ollama_port": 11434,
            "control_plane_pid": 12347,
            "vault_state": "unlocked",
            "timestamp": 1708012800
          }

        ----------------------------------------------------------------------

      â””â”€ STATUS
        Check Nucleus service status

        Usage: nucleus service status

        Flags:
          --json                     Output result as JSON

        Example:
            nucleus service status
            nucleus --json service status

        JSON Response:
          {
            "success": true,
            "running": true,
            "pid": 12345,
            "components": {
              "temporal": "healthy",
              "worker": "healthy",
              "ollama": "healthy",
              "control_plane": "healthy"
            },
            "timestamp": 1708012800
          }

        ----------------------------------------------------------------------

      â””â”€ STOP
        Stop running Nucleus service gracefully

        Usage: nucleus service stop

        Flags:
          --json                     Output result as JSON

        Example:
            nucleus service stop
            nucleus --json service stop

        JSON Response:
          {
            "success": true,
            "message": "Service stopped gracefully",
            "timestamp": 1708012800
          }

        ----------------------------------------------------------------------

    --------------------------------------------------------------------------------

  > SYNAPSE
    Temporal workflow orchestration via Sentinel

    Usage: nucleus synapse

    Subcommands:
      launch                Launch Sentinel for a profile (with pre-flight check)
        nucleus synapse launch <profile_id>
      seed                  Create new persistent profile workflow
        nucleus synapse seed <alias>
      shutdown              Shutdown a profile workflow gracefully
        nucleus synapse shutdown <profile_id>
      shutdown-all          Shutdown all orchestrated services gracefully
        nucleus synapse shutdown-all
      start-ollama          Start Ollama AI service via Temporal workflow
        nucleus synapse start-ollama
      status                Query current profile workflow status
        nucleus synapse status <profile_id>
      vault-status          Query Vault lock state via Brain
        nucleus synapse vault-status

    Subcommand Details:

      â””â”€ LAUNCH
        Launch Sentinel for a profile (with pre-flight check)

        Usage: nucleus synapse launch <profile_id>

        Arguments:
          <profile_id>          required

        Flags:
          --json                     Output in JSON format
          --mode                     Launch mode (landing, discovery) [default: landing]
          --skip-preflight           Skip Brain/launcher pre-flight check

        Example:
            nucleus synapse launch prf_a1b2c3d4
            nucleus synapse launch prf_a1b2c3d4 --mode discovery
            nucleus synapse launch prf_a1b2c3d4 --skip-preflight
            nucleus --json synapse launch prf_a1b2c3d4

        JSON Response:
          {
            "success": true,
            "profile_id": "prf_a1b2c3d4",
            "chrome_pid": 14832,
            "debug_port": 9222,
            "extension_loaded": true,
            "state": "RUNNING"
          }

        ----------------------------------------------------------------------

      â””â”€ SEED
        Create new persistent profile workflow

        Usage: nucleus synapse seed <alias>

        Arguments:
          <alias>               required

        Flags:
          --json                     Output in JSON format
          --master                   Create as master profile

        Example:
            nucleus synapse seed my-profile
            nucleus synapse seed my-profile --master
            nucleus --json synapse seed my-profile

        JSON Response:
          {
            "success": true,
            "profile_id": "prf_a1b2c3d4",
            "alias": "my-profile",
            "workflow_id": "seed_my-profile_1740000000",
            "state": "SEEDED"
          }

        ----------------------------------------------------------------------

      â””â”€ SHUTDOWN
        Shutdown a profile workflow gracefully

        Usage: nucleus synapse shutdown <profile_id>

        Arguments:
          <profile_id>          required

        Flags:
          --json                     Output in JSON format

        Example:
            nucleus synapse shutdown prf_a1b2c3d4
            nucleus --json synapse shutdown prf_a1b2c3d4

        JSON Response:
          {
            "success": true,
            "profile_id": "prf_a1b2c3d4",
            "message": "shutdown signal sent"
          }

        ----------------------------------------------------------------------

      â””â”€ SHUTDOWN-ALL
        Shutdown all orchestrated services gracefully

        Usage: nucleus synapse shutdown-all

        Example:
            nucleus synapse shutdown-all
            nucleus --json synapse shutdown-all

        JSON Response:
          {
            "success": true,
            "services_shutdown": ["ollama", "profile_prf_a1b2c3d4"],
            "count": 2
          }

        ----------------------------------------------------------------------

      â””â”€ START-OLLAMA
        Start Ollama AI service via Temporal workflow

        Usage: nucleus synapse start-ollama

        Flags:
          --simulation               Run in simulation mode (no real process)

        Example:
            nucleus synapse start-ollama
            nucleus synapse start-ollama --simulation
            nucleus --json synapse start-ollama

        JSON Response:
          {
            "success": true,
            "pid": 18340,
            "port": 11434,
            "state": "RUNNING"
          }

        ----------------------------------------------------------------------

      â””â”€ STATUS
        Query current profile workflow status

        Usage: nucleus synapse status <profile_id>

        Arguments:
          <profile_id>          required

        Flags:
          --json                     Output in JSON format

        Example:
            nucleus synapse status prf_a1b2c3d4
            nucleus --json synapse status prf_a1b2c3d4

        JSON Response:
          {
            "success": true,
            "status": {
              "profile_id": "prf_a1b2c3d4",
              "state": "RUNNING",
              "sentinel_running": true,
              "last_update": "2026-02-21T19:51:07Z",
              "error_message": ""
            }
          }

        ----------------------------------------------------------------------

      â””â”€ VAULT-STATUS
        Query Vault lock state via Brain

        Usage: nucleus synapse vault-status

        Example:
            nucleus synapse vault-status
            nucleus --json synapse vault-status

        JSON Response:
          {
            "success": true,
            "vault_state": "UNLOCKED",
            "master_profile_active": true,
            "state": "HEALTHY",
            "timestamp": 1740000000
          }

        ----------------------------------------------------------------------

    --------------------------------------------------------------------------------

  > WORKER
    Inicia el worker de Temporal para procesar workflows

    Usage: nucleus worker start

    Arguments:
      start                 required

    Flags:
      --task-queue, -q           Task queue de Temporal [default: profile-orchestration]

    --------------------------------------------------------------------------------



------------------------------------------------------------------------------------------------------------------------
  ðŸ’¡ COMMON MISTAKES & TIPS
------------------------------------------------------------------------------------------------------------------------

  X MISTAKE #1: Placing --json flag after the command
     Wrong:   nucleus synapse seed profile --json
     Correct: nucleus --json synapse seed profile

  X MISTAKE #2: Expecting clean JSON without redirecting stderr
     Issue:   Logs appear mixed with JSON in console
     Fix:     Use 2>$null (PowerShell) or 2>/dev/null (Bash)
     Example: nucleus --json info 2>$null

  * TIP: When integrating with scripts/automation
     âˆš Always use --json flag for parseable output
     âˆš Always redirect stderr (2>$null) for clean JSON
     âˆš stdout will contain ONLY valid JSON
     âˆš stderr will contain human-readable logs


                                  [!] Nucleus: Governance Layer for Bloom Organization
                            Use 'nucleus <command> --help' for detailed command information

